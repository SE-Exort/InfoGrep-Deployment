# Default values for infogrep.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Provide a name in place of `infogrep`
nameOverride: infogrep
# -- String to fully override `"infogrep.fullname"`
fullnameOverride: ""
# -- Override the Kubernetes version, which is used to evaluate certain manifests
kubeVersionOverride: ""
# Override APIVersions
# If you want to template helm charts but cannot access k8s API server
# you can set api versions here
apiVersionOverrides: {}
replicaCount: 1
namespace: infogrep
domain: local.infogrep.ai

# -- Ai Service Config
AiService:
  name: ai-service
  # -- Default namespace
  namespace: ""
  # -- GHCR Config
  image:
    repository: ghcr.io/se-exort/ai-service
    pullPolicy: IfNotPresent
    tag: latest
  # -- GHCR Image Pull Secret
  imagePullSecrets:
    - name: ghcr
  # -- Service Account
  serviceAccount:
    create: true
    name: ai-service-account
    annotations: {}
    labels: {}
    automountServiceAccountToken: true
  # -- Container Ports
  containerPorts:
    server: 8004
  # -- Resource Limits
  resources:
   limits:
      cpu: 500m
      memory: 1Gi
   requests:
      cpu: 500m
      memory: 512Mi
  # -- K8s Service Configuration
  service:
    annotations: {}
    labels: {}
    type: NodePort
    nodePortHttp: 30080
    servicePortHttp: 8004
    servicePortHttpName: ai-service-port
    servicePortHttpsAppProtocol: ""
    loadBalancerClass: ""
    loadBalancerIP: ""
    loadBalancerSourceRanges: []
    externalIPs: []
    externalTrafficPolicy: Cluster
    sessionAffinity: None
  # -- Ingress configuration
  ingress:
    enabled: true
    controller: generic
    labels: {}
    annotations:
      nginx.ingress.kubernetes.io/use-regex: "true"
      kubernetes.io/ingress.class: "nginx"
    ingressClassName: nginx
    hostname: ""
    # -- The path to Argo CD server
    path: /
    # -- Ingress path type. One of `Exact`, `Prefix` or `ImplementationSpecific`
    pathType: Prefix
    tls: false
    extraHosts: []
    extraPaths: []
    extraRules: []
    extraTls: []

# -- Authentication Service Config
AuthService:
  name: auth-service
  # -- Default namespace
  namespace: ""
  # -- GHCR Config
  image:
    repository: ghcr.io/se-exort/auth-service
    pullPolicy: IfNotPresent
    tag: dev
  # -- GHCR Image Pull Secret
  imagePullSecrets:
    - name: ghcr
  # -- Service Account
  serviceAccount:
    create: true
    name: auth-service-account
    annotations: {}
    labels: {}
    automountServiceAccountToken: true
  # -- Container Ports
  containerPorts:
    server: 4000
  # -- Resource Limits
  resources:
   limits:
      cpu: 500m
      memory: 1Gi
   requests:
      cpu: 500m
      memory: 512Mi
  # -- K8s Service Configuration
  service:
    annotations: {}
    labels: {}
    type: NodePort
    nodePortHttp: 30081
    servicePortHttp: 4000
    servicePortHttpName: auth-service-port
    servicePortHttpsAppProtocol: ""
    loadBalancerClass: ""
    loadBalancerIP: ""
    loadBalancerSourceRanges: []
    externalIPs: []
    externalTrafficPolicy: Cluster
    sessionAffinity: None
  # -- Authentication Service Init Containers
  initContainers:
    - name: wait-for-postgres
      image: busybox
      command: ["/bin/sh","-c"]
      args: ["until echo 'Waiting for auth service postgres...' && nc -vz -w 2 $PGHOST 5432; do echo 'Looping forever...'; sleep 2; done;"]
      env:
        - name: PGHOST
          valueFrom:
            configMapKeyRef:
              name: auth-service-pg-configs
              key: pgHost
              optional: false

# -- Auth Service Postgres Config
AuthPostgres:
  # -- Auth Postgress Name
  name: auth-postgres
  # -- Default Docker Hub Postgres Image
  image:
    repository: postgres
    pullPolicy: IfNotPresent
    tag: latest
  # -- Default namespace
  namespace: ""
  # -- Postgres Resource Config 
  resources:
    limits:
        cpu: 500m
        memory: 1Gi
    requests:
        cpu: 500m
        memory: 512Mi
  # -- Container Ports
  containerPorts:
    postgres: 5432
  # -- Postgres Readiness Probe
  readinessProbe:
    enabled: true
    command: 
      - "pg_isready" 
      - "-U" 
      - "postgres"
    failureThreshold: 3
    initialDelaySeconds: 10
    periodSeconds: 5
    successThreshold: 1
    timeoutSeconds: 5
  # -- K8s Service Configuration
  service:
    annotations: {}
    labels: {}
    type: NodePort
    nodePortHttp: 30082
    servicePortHttp: 5432
    servicePortHttpName: auth-postgres-port
    servicePortHttpsAppProtocol: ""
    loadBalancerClass: ""
    loadBalancerIP: ""
    loadBalancerSourceRanges: []
    externalIPs: []
    externalTrafficPolicy: Cluster
    sessionAffinity: None
  # -- Postgres Env
  env:
    username: postgres
    password: example